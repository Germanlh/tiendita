/*********** Creamos Tabla USUARIOS************************************************************************
// 
Crear, Consultar, Modificar, Eliminar

Los usuarioos son los trabajadores de Krea que usaran directamente el sistema dependiendo de los permisos
que les sean otorgados son las capacidades de cambiar o modificar los datos necesarios o simplemente consultarlos
//
idkrea varchar(13)  		//  --Primaria-- Identificador unico para cada usuario generado por una función
status tinyint,				// 1-->Activo 2-->inactivo  permite desactivar de manera temporal
usuario varchar(15) 		//  Nombre de usuario (nickname)
password varchar(15) 	//  password de usuario
permisos tinyint			// Tipo de usuario 1->Admin, 2->Encargado, 3->JefeProd, 4->ventas, 5->mostrador, 6->impresor 7->taller


/*********** Agregamos el primer super usuario ***********************************************************/
//
Al inicio de la instalacion no habra nada mas que las tablas creadas, asi que para inicializar los primeros usarios creamos al primer
super usuario, este super usuario puede ser borrado posteriormente por el usuario administrador.
Tal vez valga la pena analizar si añadimos un super usuario fijo, para fines de administración general independiente de las claves de los
usuarios, como medida preventiva en caso de que al admin se le olvide su propia contraseña.
//

idkrea = 1111111111111
status = 1
usuario = Program
password = margorp
permisos = 0

/*********** Creamos Tabla DIRECTORIO************************************************************************
//
		Admin puede realizar todos los cambios
Crear,  			Todos	
Consultar,		Todos 
Modificar, 		Solo modifican los propietarios (ventas, mostrador, krea) Encargado-> los terceros, proveedores maquiladores,
Eliminar			Propietarios (ventas, mostrador, krea) y Encargado

En esta Tabla se encuentran registrados los datos basicos de diferentes personajes relacionados a krea
diferenciandolos por la variable  "tipo" estos personajes son clientes, trabajadores krea, proveedores, 3eros,
Maquiladores, contactos. esta es la tabla que funge como directorio de todos, rescatando sus datos desde las
paginas de aplicación.
en esta tabla se asigna un identificador unico para cada cliente, lo que permite identificar de manera correcta a cada uno 
de aquellos que estan registrados en esta tabla.
Como costumbre, incluso aquellos clientes que llegan a mostrador, se toman sus datos mas basicos para poder localizarlos 
posteriormente y no tipear de manera constante sus datos.
//
idcliente varchar(13) 	// --Primaria-- Identificador unico e irrepetible
status tinyint,				// Indica si el usuario se encuentra activo o dado de baja temporal 1->Activo 0->Inactivo
tipo tinyint,					// 1->Krea, 2->cliente, 3->proveedor, 4->tercero, 5->maquilador
idempresa varchar(13) 	// nos permite relacionarlo con la Empresa en la que trabaja el usuario sea persona fisica o moral 
nombres varchar(40) 	// Nombre o nombres
apellidos varchar(40) 	// Apellidos
direccion varchar(40) 	// Calle y numero
colonia varchar(25) 		// Colonia en la que habita
ciudad varchar(25) 		// Ciudad a la que pertenece
estado varchar(25) 		// Estado en el que radica
codpos smallint,				// Codigo postal
tel1 varchar(16) 			// Telefono principal (puede ser celular)
tel2 varchar(16) 			// Telefono secundari (puede ser celular)
cel varchar(16) 			// Celular personal
email1 varchar(40) 		// Correo personal
email2 varchar(40) 		// 2do Correo 
idvendedor varchar(13) // ID del vendedor de Krea que lo está atendiendo directamente.
ventaanterior datetime,	// Fecha de la penultima venta que tuvo este cliente
ventaultima datetime	// Fecha de la ultima venta realizada por el cliente

/*********** Creamos Tabla EMPRESA**************************************************************************
//
			Admin puede realizar todos los cambios
Crear,  			Todos	
Consultar,		Todos 
Modificar, 		Solo modifican los propietarios (ventas, mostrador) Encargado-> los terceros, proveedores maquiladores, krea
Eliminar			Propietarios y Encargado

En esta tabla colocamos todos los datos para facturacion de cada empresa o persona fisica, cada empresa puede tener 
uno o mas contactos que estan relacionados mediante  el "idcliente", de la misma forma cada empresa esta relacionada
al responsable de la venta y de gestionar al cliente.
//
idempresa varchar(13) 		// --primaria-- Identificador unico para cada empresa que nos permite identificarlo y relacionarlo con otras tablas
status tinyint,					// Marca si la empresa se encuentra activa o dada de baja temporal
ncomercial varchar(40) 	// Es el nombre "Comun" por el que se conoce la empresa 
razonsocial varchar(60) 	// Es el nombre al que se realiza la factura "nombre Oficial"
rfc varchar(13) 				// RFC de Oficial para el SAT
calle varchar(40) 				// La calle de la Domicilio Fiscal
numero varchar(40) 		// Numero del domicilio fiscal
colonia varchar(25) 			// Colonia del domicilio fiscal
ciudad varchar(25) 			// Ciudad del Domicilio fiscal
estado varchar(25) 			// Estado del Domicilio fiscal
codpos tinyint,					// Codigo Postal del domicilio Fiscal
tel1 varchar(13) 				// Telefono de la Empresa (Opcional)
tel2 varchar(13) 				// Segundo Telefono (opcional)
email1 varchar(30) 			// Email de la empresa
email2 varchar(30) 			// 2do Email de la Empresa
idcliente1 varchar(13) 		// Primer Contacto dentro de la empresa (Publicidad, marketing, etc)
idcliente2 varchar(13) 		// Segundo contacto
idcliente3 varchar(13) 		// Tercer contacto
idvendedor varchar(13) 	// ID del Vendedor asignado a esta empresa
ventaanterior datetime,		// Penultima venta realizada para la empresa
ventaultima datetime		// Ultima Venta de la empresa

/*********** Creamos Tabla CALENDARIO ***********************************************************************
//
Crear, Consultar,  Eliminar, Recalendarizar

Cada calendario es particular de cada usuario.
Solo tendran calendarios 
	-Jefe prod			//	Usara el calendario para calendarizar Instalaciones o salidas programadas del taller
	-Ventas			// Citas y eventos pendientes con sus clientes
	-Encargado 		// Lo usara para regular gestion de terceros, mensajeria y proveedores y podrá ver el de los demás
	-Admin 			//	Tendra su calendario propio y podrá ver y gestionar el de los demás
	
cada calendario es particular
se controlan varios eventos en una misma hora enviando la correspondiente Advertencia

En esta Tabla colocamos los pendientes que cada usuario puede colocar para mostrarse en un calendario
organizado por fechas y hora la funcion es de una agenda que recordara al usuario de sus actividades
//


idusuario varchar(13) 	// Id del usuario a quien pertenece esta nota
idcliente varchar(13) 	// Identificador del cliente con quien tiene la cita o pendiente
status tinyint,				// Si es una actividad activa o pendiente o si ya ha pasado
evento varchar(25)		// Nombre del evento de que se trata "Reunion, cita, entregar material, etc."
fechainicio date,		// Cuando se ejecuta este evento
horainicio time,
fechafin date,				// Cuando termina el evento (opcional)
horafin time,
comentarios text 			// Breve descripcion del evento (opcional)
prioridad tinyint				// Indica la prioridad del evento en cuestion 1-> Muy Alta  2-> Alta   3->Normal   4->No necesaria
idevcal							// identifica a cada evento en particular

/*********** Creamos Tabla RECADOS *************************************************************************
//
Crear, Consultar, Eliminar

En esta tabla guardamos los recados que se originan durante el dia, el usuario al entrar a su pagina observará todos 
los recados que tomaron algunos de los otros compañeros
//
iddestinatario varchar(13) 	// A quien va dirigido el mensaje que se recibió
idreceptor varchar(13)			// Quien recibió el mensaje
emisor varchar(20) 				// Quien fue la persona que hablo
fecha datetime,						// Cuando se recibió el mensaje
tipo tinyint,							// Clasificación del mensaje 1->Urgente 2->Que se comunique 3-> Que pasa a verlo a cierta hora
												4-> Se comunica despues 5->Solicita Cita  6->Vino a verlo
mensaje tinytext 					// Cual fue el recado
tel varchar(13) 					// Telefono del Emisor
empresa varchar(15) 			// Empresa a la que pertenece
status  tinyint						// 1-> Pendiente (Activo)  2-> Leido (Baja)
idrecado varchar(13)			// Identifica unicamente a cada Recado

/*************************************************************************************/
/*************************************************************************************/
/*************************************************************************************/
/*************************************************************************************/
/*************************************************************************************/
/*********** Creamos Tabla NOTA ****************************************************************************
//
Crear, Consultar

Una cotización que se realiza a un cliente se toma como una prenota, y esta no se ejecuta hasta que haya sido aprobada la 
cotizacion entonces se transforma en una nota Formal y entra al rio de produccion.
Para generar una nota o cotización es necesario haber capturado los datos del cliente o de la empresa para poder relacional la 
nota generada con dicho cliente o empresa.
No se asigna id de nota si no se ha confirmado la cotización, todas las notas pasaran por el mismo proceso
Cada nota tendrá por lo menos un Trabajo a realizarse y estaran debidamente relacionados.
Pueden existir hasta 4 ordenes de trabajo diferentes para una sola nota, lo que permite tomar medidas o instalaciones 
relacionadas a una unica nota.
Existira una cola de trabajos indicando la prioridad de cada una y estas prioridades de los trabajos estaran heredadas por la nota
1-> Ahora mismo  2-> Transcurso del dia   3->24horas  4-> mas de 24 hrs 
el cambio de prioridades lo puede hacer el jefe de produccion o el administrador nada mas. los trabajos pueden tener un grado diferente
de prioridad pero solo el administrador podrá cambiar este estado

	Manejar la concurrencia con el id de la nota
	Menejar las cancelaciones de notas o de trabajos
	considerar las partidas que no se aprobaron  de la cotización
//
idcotizacion varchar(10) 	// ID unica para cada cotizacion
datecotiza datetime,			// ID Fecha en que se hizo la cotizacion
idnota varchar(10)			// Cuando se autoriza la cotizacion se Agrega ID Nota CHARACTER SET utf8 COLLATE utf8_general_ci,
datenota datetime,			// Fecha en la que se autorizo la cotizacion
dateentrega datetime,		// Fecha en la que requiere el trabajo terminado
prioridad tinyint,				// Que prioridad tiene sobre otros trabajos 1-> Ahora mismo  2-> Transcurso del dia  
											3->24horas  4-> mas de 24 hrs  
idcliente varchar(13) 		// ID del cliente que pidio los trabajos
importe int,						// Importe total de la nota
iva int,								// IVA del importe total
adelanto1 int,					// Pago parcial de la Nota
adelanto2 int,					// 2do Pago Parcial de  la nota
adelanto3 int,					// 3er Pago parcial de la nota
metpago1 varchar(13) 		// Foma de pago del primer adelanto
metpago2 varchar(13) 		// Forma de pago del 2 adelanto
metpago3 varchar(13) 		// Forma de pago del 3er adelanto
liquidado tinyint,				// Estado de la lona Pendiente o liquidado
dateliquidado datetime,		// Fecha del dia en que se liquido  la nota
factura int,						// Numero de folio de la factura que le corresponde
datefactura datetime,		// Fecha del dia de expedicion de la factura
identrega varchar(13) 		// ID de quien entregó el producto
dateentregareal datetime,	// Fecha real de la entrega del producto
otrab1 varchar(13) 			// Orden de trabajo relacionada a esta nota
otrab2 varchar(13)			// Orden de trabajo relacionada a esta nota
otrab3 varchar(13)			// Orden de trabajo relacionada a esta nota
otrab4 varchar(13)			// Orden de trabajo relacionada a esta nota

/*********** Creamos Tabla TRABAJOS ************************************************************************
//
Crear, Consultar

La tabla de trabajos contiene los trabajos se se solicitan mediante una nota de trabajo, cada nota puede tener varios trabajos
a realizar  en cambio cada trabajo individual esta relacionado solo a una nota, la prioridad de los trabajos esta marcado por la nota
de origen, sin embargo, se puede modificar de manera individual la prioridad de cada trabajo dependiendo exclusivamente del 
administrador o del jefe de produccion.
El rio de produccion se encuentra manifestado en esta tabla, colocando la fecha en que pasa por cada seccion, o dejando libre ese
campo, para denotar que no se ha realizado
//
idnota varchar(13) 		// ID de la nota donde se registro el trabajo
status tinyint,				// Indicador del status del trabajo 1-> Cotizacion  2->Pendiente 3-> Terminado
prioridad tinyint,			// Que prioridad tiene sobre otros trabajos 1-> Ahora mismo  2-> Transcurso del dia  
										3->24horas  4-> mas de 24 hrs  
acabados tinytext 		// Detalles de como debe terminar 
cantidad int,					// Cuantas piezas del material
material varchar (20) 	// Que tipo de material solicita, Lona, vinil, etc.
base int,						// Medida horizontal
altura int,						// Meidida vertical
tecnicaimp varchar (13)// Tecnica de impresion GF, Offset, Serigrafia, Etc
punitario int,					// Precio por Producto por cada pieza
importe int,					// Precio total
diseño datetime,			// Fecha en la que se realizo diseño 1111111111->requiere pero Pendiente 20140508->Fecha de realizacion
impresion datetime,		// Fecha en la que se realizo impresion 1111111111->requiere pero Pendiente 20140508->Fecha de realizacion
produccion datetime,		// Fecha en la que se realizo Produccion 1111111111->requiere pero Pendiente 20140508->Fecha de realizacion
instalacion datetime		// Fecha en la que se realizo Instalacion 1111111111->requiere pero Pendiente 20140508->Fecha de realizacion

/*********** Creamos Tabla VENTAS estadistica ******************************************************************
//
Crear, Consultar

Tabla en la que mostramos las estadisticas de ventas colocados por semana, esta tabla es de caracter informativo
express, solo por colocar una forma de acceder al status general de ventas, los detalles de las consultas pueden ser consultadas
de forma manual.
//
lunes datetime,			// Fecha del lunes (inicio de semana)
sabado datetime,		// Fecha del lunes (fin de semana)
implunes int,				// Importe total de las notas generadas el dia lunes
impmartes int,			// Importe total de las notas generadas el dia martes
impmiercoles int,		// Importe total de las notas generadas el dia miercoles
impjueves int,			// Importe total de las notas generadas el dia jueves
impviernes int,			// Importe total de las notas generadas el dia viernes
impsabado int,			// Importe total de las notas generadas el dia sabado
numnotas int,			// Cantidad de Notas totales a la semana
notassaldadas int		// Cantidad de notas completamente saldadas

/*********** Creamos Tabla SEMAFORO estadistica ****************************************************************
//
Crear, Consultar

Tabla estadistica de consulta rapida para tener un panorama de los clientes que son poco frecuentes solo para visualizar
sin embargo una analisis mas profundo requeriría de un analisis personalizado.
//
idcliente varchar(13) 		// ID del cliente al cual se hace referencia
idvendedor varchar(13) 	// ID del vendedor el cuel es encargado de la gestion de esta cuenta
ncomercial varchar(40)		// Nombre comercial de la Empresa
ventaanterior datetime,		// Penultima fecha en la que realizo compra
ventaultima datetime		// Ultima fecha de compra realizada

/*************************************************************************************/
/*************************************************************************************/
/*************************************************************************************/
/*************************************************************************************/
/*************************************************************************************/
/*************************************************************************************/
/*************************************************************************************/
/*************************************************************************************/
/*************************************************************************************/
/************************ Manipular Datos en tablas Mysql  ************************************************/

$query=mysql_query(
			"INSERT INTO 
			usuarios (idkrea,status,usuario, password, permisos)
			VALUES ('$idkrea','$status','$usr', '$psw', '$permisos')
			");
		if(!$query){die("PROBLEMAS: ".mysql_error());	}

		
$consulta=mysql_query("SELECT  * FROM usuarios WHERE usuario='$usr'");
	while($fila=mysql_fetch_array($consulta)){
		if($fila['usuario']=$usr){$repeticiones++;}
		}

$query=mysql_query("
		UPDATE usuarios 
		SET usuario='lalo', password='9874', status='0' 
		WHERE usuario='$usr' AND password='$psw'	");
		if(!$query){die("PROBLEMAS: ".mysql_error());}

		
$query=mysql_query("DELETE FROM usuarios WHERE  usuario='$usr' AND password='$psw'");
if(!$query){die("PROBLEMAS: ".mysql_error());	}

/******************** Variables multiproposito ***********************************************************/

$_SESSION['oldusr']="nada"; 
$_SESSION['oldidkrea']="nada";

/******************** Nos envia a otro script ***********************************************************/
header ("Location: ../aadmin.php");

echo '
	<html>
		<head><meta http-equiv="REFRESH" content="0;url=../aadmin.php"></head>
	</html>
	';*/

	//if($ok){echo "<SCRIPT>window.location='../aadmin.php';</SCRIPT>"; }	//nos envia a otra ventana

/***************************  Cerrar sesion************************************************************/

// Initialize the session. 
// If you are using session_name("something"), don't forget it now! 
session_start(); 

// Unset all of the session variables. 
$_SESSION = array(); 

// If it's desired to kill the session, also delete the session cookie. 
// Note: This will destroy the session, and not just the session data! 
if (isset($_COOKIE[session_name()])) { 
   setcookie(session_name(), '', time()-42000, '/'); 
} 

/*
if (ini_get("session.use_cookies")) {
    $params = session_get_cookie_params();
    setcookie(session_name(), '', time() - 42000,
        $params["path"], $params["domain"],
        $params["secure"], $params["httponly"]
    );
}
*
// Finally, destroy the session. 
session_destroy(); 
// Y redireccionas a donde quieras ir ... 
//header ("Location: dondequieras.php"); 
exit; 

/***********************************************************************************************/
/* 
idate(); Nos devuelve la fecha en formato INT de acuerdo a los siguientes valores

Y -> Año 4 digitos
L->1 año bisiesto 0 no

I-> (i mayuscula) 1 horariod de verano 0 no

m -> mes actual
d->Dia del mes actual
t-> dias en el mes actual

w-> dia de la semana (domingo 0)

z -> dia del año

H-> Hora (24 horas) h (12 horas)
i -> minutos
s -> segundos
*/
date(); Nos devuelve la fecha formateada en string

int mktime ($hora,$minuto,$segundo,$mes,$dia,$año,$hverano) // Nos devuelve un timestamp colocando los valores
strtotime('previous month'.$fecha) // Nos devuelve una marca de tiempo permitiendonos usar formatos Relativos

/***********************************************************************************************/
function bisiesto($year) {// Devuelve true or false
    return ( ($year%4 == 0 && $year%100 != 0) || $year%400 == 0 );
	}	
/*************************** EXPRESIONES REGULARES *****************************************************/
para Pattern en los input HTML
o para preg_match() en PHP
Tambien funcionan en Javascript
filter_var() // Nos apoya para validar expresiones video2brain

^ Principio de entrada o línea.
$ Fin de entrada o línea.
* El carácter anterior 0 o más veces.
+ El carácter anterior 1 o más veces.
? El carácter anterior una vez como máximo (es decir, indica que el carácter anterior es opcional).
. Cualquier carácter individual, salvo el de salto de línea.
x|y x o y.
{n} Exactamente n apariciones del carácter anterior.
{n,m} Como mínimo n y como máximo m apariciones del carácter anterior.
[abc] Cualquiera de los caracteres entre corchetes. Especifique un rango de caracteres con un guión (por ejemplo, [a-f] es equivalente a [abcdef]).
[^abc] Cualquier carácter que no esté entre corchetes. Especifique un rango de caracteres con un guión (por ejemplo, [^a-f] es equivalente a [^abcdef]).
\b Límite de palabra (como un espacio o un retorno de carro).
\B Cualquiera que no sea un límite de palabra.
\d Cualquier carácter de dígito. Equivalente a [0-9].
\D Cualquier carácter que no sea de dígito. Equivalente a [^0-9].
\f Salto de página.
\n Salto de línea.
\r Retorno de carro.
\s Cualquier carácter individual de espacio en blanco (espacios, tabulaciones, saltos de página o saltos de línea).
\S Cualquier carácter individual que no sea un espacio en blanco.
\t Tabulación.
\w Cualquier carácter alfanumérico, incluido el de subrayado. Equivalente a [A-Za-z0-9_].
\W Cualquier carácter que no sea alfanumérico. Equivalente a [^A-Za-z0-9_].
/***********************************************************************************************/
